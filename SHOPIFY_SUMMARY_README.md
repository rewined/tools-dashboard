# Shopify Weekly Summary Tool

An AI-powered analytics tool that automatically generates and emails conversational weekly reports for your Shopify store, with two-way email communication for continuous improvement.

## Features

### 🤖 AI-Powered Insights
- Conversational reports generated by Claude AI
- Personalized insights based on your business context
- Smart trend identification and pattern recognition
- Actionable recommendations

### 📧 Automated Email Delivery
- Weekly reports sent every Monday morning (configurable)
- Beautiful HTML emails with a friendly, conversational tone
- PDF attachments with detailed analytics
- Customizable recipient list

### 💬 Two-Way Communication
- Recipients can reply to emails with feedback
- System learns from responses to improve future reports
- Tracks custom metrics based on feedback
- Builds context over time for better insights

### 📊 Comprehensive Analytics
- Revenue tracking with year-over-year comparisons
- Product performance analysis
- Workshop attendance and revenue tracking
- Customer behavior insights
- Inventory level monitoring

### 🎨 Web Interface
- Manual report generation
- Preview reports before sending
- View feedback history
- Configure email preferences

## Setup Instructions

### 1. Environment Configuration

Copy `.env.example` to `.env` and configure:

```bash
cp .env.example .env
```

Required environment variables:

```env
# Shopify Configuration (already configured)
SHOPIFY_SHOP_DOMAIN=candlefish1.myshopify.com
SHOPIFY_ACCESS_TOKEN=your-shopify-access-token
SHOPIFY_API_KEY=your-shopify-api-key

# Email Configuration (needs setup)
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=true
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password  # Use App Password for Gmail
MAIL_DEFAULT_SENDER=Candlefish Analytics <insights@candlefish.com>

# Recipients
EMAIL_RECIPIENTS=owner@candlefish.com,manager@candlefish.com

# Claude AI (needs API key)
ANTHROPIC_API_KEY=your-anthropic-api-key

# Scheduler
SCHEDULER_TIMEZONE=America/New_York
WEEKLY_REPORT_HOUR=8
WEEKLY_REPORT_DAY=0  # 0=Monday
```

### 2. Gmail App Password Setup

1. Go to [Google Account Settings](https://myaccount.google.com/)
2. Navigate to Security → 2-Step Verification
3. Click on "App passwords"
4. Generate a new app password for "Mail"
5. Use this password in `MAIL_PASSWORD`

### 3. Install Dependencies

```bash
pip install -r requirements.txt
```

### 4. Initialize Database

The database will be created automatically on first run at `data/feedback.db`

### 5. Run the Application

```bash
python app_toolkit.py
```

Access the tool at: http://localhost:5000/shopify-summary

## Usage Guide

### Manual Report Generation

1. Navigate to the Shopify Summary tool
2. Enter recipient email and name
3. Select the week to analyze
4. Click "Generate & Send Report"

### Email Reply System

Recipients can reply to weekly emails with:
- Questions about the data
- Additional context about events
- Requests to track specific metrics
- Preferences for report timing

Example replies:
- "Tuesday was the town festival - that explains the low attendance"
- "Please track our new lavender product line more closely"
- "Can you send reports on Tuesday instead?"

### Viewing Feedback

All feedback appears in the web interface under "Recent Customer Feedback"

## Email Examples

### Sample Weekly Email

```
Subject: Hey Sarah! Your Candlefish weekly recap is here 🕯️

Hey Sarah! 👋

Hope you had a fantastic weekend! I've been digging through your 
numbers from last week, and I've got some exciting insights to share.

🌟 Your Week in Highlights:
- Total Revenue: $4,827.50 (+23.4% YoY)
- Orders: 87 (+15.0% YoY)
- Avg Order Value: $55.49 (+7.3% YoY)
- Items Sold: 312 (+18.2% YoY)

What Caught My Eye:
Your lavender collection is absolutely flying off the shelves! 
I noticed 62 units sold this week alone. The Saturday candle-making 
workshop was also a huge hit with 24 attendees - that's your 
highest attendance this year!

I'm Curious About...
• I noticed Tuesday's workshop had lower attendance than usual. 
  Was there something special happening in town?
• The lavender products are doing amazingly well - are you 
  planning any lavender-themed workshops?
• Your evening sales seem to be increasing. Have you extended hours?

Looking forward to hearing your thoughts! Just hit reply - 
I actually read these. 😊

Cheers,
Your Friendly Analytics Assistant

[View Full Dashboard] [PDF Report Attached]
```

## Deployment to Railway

1. Ensure all changes are pushed to GitHub
2. Railway will auto-deploy from the main branch
3. Add environment variables in Railway dashboard
4. The scheduler will start automatically

## Troubleshooting

### Email Not Sending
- Verify SMTP credentials
- Check firewall settings
- Ensure app passwords are used (not regular passwords)
- Check spam folder

### Shopify API Errors
- Verify API credentials are correct
- Check API rate limits
- Ensure proper permissions

### Scheduler Not Running
- Check timezone settings
- Verify scheduler is initialized
- Check application logs

## Architecture

```
src/
├── email_service.py          # Email templates and sending
├── shopify_service.py        # Shopify API integration
├── shopify_analytics.py      # Data analysis and metrics
├── conversational_insights.py # Claude AI integration
├── shopify_report_generator.py # PDF generation
├── feedback_database.py      # SQLite database management
├── reply_processor.py        # Email reply handling
└── scheduler.py              # APScheduler configuration

templates/tools/
└── shopify_summary.html      # Web interface

data/
├── feedback.db              # SQLite database
├── conversation_history.json # AI conversation memory
└── feedback_context.json    # Extracted feedback context
```

## Future Enhancements

- SMS notifications for critical metrics
- Slack integration
- Custom report scheduling per recipient
- A/B testing for email content
- Multi-store support
- Advanced forecasting

## Support

For issues or questions about the Shopify Weekly Summary tool:
1. Check the logs in the web interface
2. Verify all environment variables are set
3. Test with the "Send Test Email" button
4. Review recent feedback for context

---

Built with ❤️ for Candlefish